{% extends "coordac/coordac_dashboard.html" %}
{% load static %}
{% load coordac_extras %}

{% block title %}Cumplimiento de tutores{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap">
        <div>
            <h2>Cumplimiento de tutores en el PIT</h2>
            <p class="text-muted mb-0">
                Periodo: {{ period }}.<br>
                Marca para cada tutor si <strong>cumpli贸</strong> o <strong>no cumpli贸</strong> con los objetivos del programa.
            </p>
        </div>
        <a href="{% url 'coordac_tutor_compliance_pdf' %}" target="_blank"
        class="btn btn-outline-primary mt-3 mt-md-0">
            <i class="bi bi-file-earmark-pdf me-1"></i> Generar reporte PDF
        </a>
    </div>

    <form method="post" class="mt-3">
        {% csrf_token %}
        <div class="table-responsive">
            <table class="table table-striped table-hover align-middle">
                <thead>
                    <tr>
                        <th>Tutor</th>
                        <th style="width: 260px;">Cumplimiento</th>
                        <th>Comentarios</th>
                    </tr>
                </thead>
                <tbody>
                    {% for a in assignments %}
                        {% with tutor=a.tutor %}
                            {% with comp=existing|dict_get:tutor.id %}
                                <tr>
                                    <td>
                                        {{ tutor.get_full_name|default:tutor.username }}
                                    </td>
                                    <td>
                                        <div class="btn-group" role="group">
                                            <input type="radio"
                                                   class="btn-check"
                                                   name="status_{{ tutor.id }}"
                                                   id="status_ok_{{ tutor.id }}"
                                                   value="COMPLIED"
                                                   {% if comp and comp.status == "COMPLIED" %}checked{% endif %}>
                                            <label class="btn btn-outline-success btn-sm"
                                                   for="status_ok_{{ tutor.id }}">
                                                Cumpli贸
                                            </label>

                                            <input type="radio"
                                                   class="btn-check"
                                                   name="status_{{ tutor.id }}"
                                                   id="status_no_{{ tutor.id }}"
                                                   value="NOT_COMPLIED"
                                                   {% if comp and comp.status == "NOT_COMPLIED" %}checked{% endif %}>
                                            <label class="btn btn-outline-danger btn-sm"
                                                   for="status_no_{{ tutor.id }}">
                                                No cumpli贸
                                            </label>
                                        </div>
                                    </td>
                                    <td>
                                        <textarea name="comments_{{ tutor.id }}"
                                                  rows="1"
                                                  class="form-control"
                                                  placeholder="Observaciones (opcional)">{% if comp %}{{ comp.comments }}{% endif %}</textarea>
                                    </td>
                                </tr>
                            {% endwith %}
                        {% endwith %}
                    {% empty %}
                        <tr>
                            <td colspan="3" class="text-center text-muted">
                                No tienes tutores asignados para este periodo.
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <button type="submit" class="btn btn-primary mt-3">
            Guardar cumplimiento
        </button>
    </form>
</div>
{% endblock %}
